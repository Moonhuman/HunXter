{"version":3,"sources":["assets\\scripts\\globalGame.js"],"names":["window","global","persons","nowTurn","isOver","cardnode","bgm","audio","loop","volume","cc","Class","Component","properties","mapObj","index","nowStep","nowPlayer","nowProperty","isWait","msgBoxConent","updateUI","onLoad","msgContent","find","node","on","event","poster","name","getComponent","RichText","string","height","ScrollView","scrollToBottom","msg","game","emit","route","moveByRoute","InitialCard","initBgm","start","initPersons","update","dt","console","log","nickname","goEnabled","step","randomNum","posEnable","map","posX","posY","turn","bindAvatar","move2Pos","i","length","nowPerson","ctx","Graphics","clear","strokeColor","Color","RED","moveTo","lineWidth","lineTo","stroke","text","Label","fontSize","setPosition","GREEN","loader","loadRes","AudioClip","err","clip","audioID","audioEngine","play","cardName","totCardNum","Array","Node","addComponent","Sprite","spriteFrame","SpriteFrame","url","raw","push","minNum","maxNum","arguments","parseInt","Math","random"],"mappings":"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","sourceRoot":"/","sourcesContent":["window.global={\r\n\tpersons:[],\r\n\tnowTurn:0,//当前回合数\r\n\tisOver:false,\r\n\tcardnode : null,\r\n\tbgm:{\r\n\t\taudio:null,\r\n\t\tloop:null,\r\n\t\tvolume:null,\r\n\t}\r\n};\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\t\tmapObj:null,//地图对象\r\n\t\tpersons:null,//玩家们\r\n\t\tindex:0,\r\n\t\tnowStep:0,\r\n\t\tnowPlayer:null,\r\n\t\tnowProperty:null,\r\n\t\tisWait:false,\r\n\t\tmsgBoxConent:null,\r\n    },\r\n\r\n    updateUI:function(){\r\n\t\t//更新人物血量\r\n\t},\r\n\r\n    onLoad () {\r\n\t\t//加载地图\r\n\t\tthis.nowStep=0;\r\n\t\tthis.msgContent=cc.find('Canvas/msgBox/view/content/item');\r\n\t\t//console.log(msgContent.getComponent(cc.Label));\r\n\t\tthis.node.on('send-Msg',function(event,poster){\r\n\t\t\tvar name='<color=#43CD80>'+poster+'</color>';\r\n\t\t\tif (poster=='系统'){\r\n\t\t\t\tname='<color=#ff0000>'+poster+'</color>';\r\n\t\t\t}\r\n\t\t\tthis.msgContent.getComponent(cc.RichText).string+=name+\": \"+event+'<br/>';\r\n\t\t\t//可能需要动态改变content大小\r\n\t\t\t\r\n\t\t\tcc.find('Canvas/msgBox/view/content').height=this.msgContent.height+10;\r\n\t\t\tcc.find('Canvas/msgBox').getComponent(cc.ScrollView).scrollToBottom(0.1);\r\n\t\t\t//console.log('Label',this.msgContent.height);\r\n\t\t\t \r\n\t\t},this);\r\n\t\t\t\r\n\t\tthis.node.on('update-state', function (msg) {\r\n\t\t\tthis.nowStep=(this.nowStep+1)%4;\r\n\t\t\tthis.isWait=false;\r\n\t\t\t\r\n\t\t},this);\r\n\t\tcc.game.on('stepOnCell-done', function ( event ) {//触发结束\r\n\t\t\tthis.node.emit('update-state', '1');//更新状态\r\n\t\t\t//console.log(\"触发了特殊格子！\");\r\n\t\t},this);\r\n\t\tcc.game.on('route-chosen', function(route) {//监听玩家选择了哪条路径\r\n\t\t\t\t\t//console.log('点击了',route);\r\n\t\t\tthis.nowProperty.moveByRoute(route);\r\n\t\t\t\t\t//this.node.emit('update-state', '1');//玩家移动完成，进入下一步操作\r\n\t\t\t\t\t//玩家头像按照路径移动\r\n\t\t},this);\r\n\t\tthis.InitialCard();\r\n\t\tthis.initBgm();\r\n\t},\r\n\t\r\n    start () {\r\n\t\t//初始化人物\r\n\t\tthis.initPersons();\r\n\t\t//获得地图对象\r\n\t\tthis.mapObj=cc.find('Canvas/map').getComponent('GetMap');\r\n\t\r\n\t\tthis.nowPlayer=window.global.persons[this.index];\r\n\t\t\r\n\t\t\r\n\t\t\r\n    },\r\n\r\n    update (dt) {\r\n\t\t//判断当前回合是否结束\r\n\t\t\r\n\t\tconsole.log(\"是否等待操作\",this.isWait);\r\n\t\tswitch (this.nowStep){\r\n\t\t\tcase 0:{//初始化变量\r\n\t\t\t\tif (this.isWait){//正在操作或等待操作\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t//this.node.emit('send-Msg','进入回合'+window.global.nowTurn,'系统');\r\n\t\t\t\t//console.log(this.nowPlayer.name);\r\n\t\t\t\tthis.nowProperty=this.nowPlayer.getComponent('Person');//获得玩家属性集合\r\n\t\t\t\tthis.node.emit('send-Msg','轮到角色'+this.nowProperty.nickname,'系统');\r\n\t\t\t\tthis.node.emit('update-state', '1');\r\n\t\t\t\t\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 1:{//玩家移动\r\n\t\t\t\tif (this.isWait){//正在操作或等待操作\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif (this.nowProperty.goEnabled){//判断玩家是否可以行走\r\n\t\t\t\t\tvar step=randomNum(1,6);//掷骰子，玩家步数\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.node.emit('send-Msg',\"获得骰子点数\"+step,this.nowProperty.nickname);\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.isWait=true;\r\n\t\t\t\t\tconsole.log(this.mapObj.posEnable(this.mapObj.map[this.nowProperty.posX][this.nowProperty.posY],step));\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.nowProperty.goEnabled=1;\r\n\t\t\t\t\tthis.node.emit('update-state', '1');\r\n\t\t\t\t}\r\n\t\t\t\t break;\r\n\t\t\t}\r\n\t\t\tcase 2:{\r\n\t\t\t\t//完成了事件触发或者卡牌触发\r\n\t\t\t\tif (this.isWait){//正在操作或等待操作\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(\"当前步骤：\",this.nowStep);\r\n\t\t\t\tconsole.log(\"玩家出牌\");\r\n\t\t\t\tthis.node.emit('update-state', '1');\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase 3:{\r\n\t\t\t\t//console.log(\"当前步骤：\",this.nowStep);\r\n\t\t\t\t//当前玩家的回合数-1\r\n\t\t\t\tthis.nowProperty.turn-=1;\r\n\t\t\t\tif (this.nowProperty.turn==0)//当前玩家回合数为0，应该切换玩家\r\n\t\t\t\t{\r\n\t\t\t\t\tconsole.log(\"切换角色\");\r\n\t\t\t\t\tthis.nowProperty.turn+=1;\r\n\t\t\t\t\tthis.index=(this.index+1)%4;\r\n\t\t\t\t\tthis.nowPlayer=window.global.persons[this.index];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.node.emit('update-state', '1');\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t},\r\n\tinitPersons:function(){\r\n\t\twindow.global.persons[0].getComponent('Person').bindAvatar(cc.find('Canvas/avatar/avatar1'));\r\n\t\twindow.global.persons[1].getComponent('Person').bindAvatar(cc.find('Canvas/avatar/avatar2'));\r\n\t\twindow.global.persons[2].getComponent('Person').bindAvatar(cc.find('Canvas/avatar/avatar3'));\r\n\t\twindow.global.persons[3].getComponent('Person').bindAvatar(cc.find('Canvas/avatar/avatar4'));\r\n\t\twindow.global.persons[0].getComponent('Person').nickname='老叟';\r\n\t\twindow.global.persons[1].getComponent('Person').nickname='少妇';\r\n\t\twindow.global.persons[2].getComponent('Person').nickname='富商';\r\n\t\twindow.global.persons[3].getComponent('Person').nickname='小女';\r\n\t\t//初始化四个玩家位置\r\n\t\t//console.log(this.mapObj.map[0][0].getPosition());\r\n\t\twindow.global.persons[0].getComponent('Person').move2Pos(0,0);\r\n\t\twindow.global.persons[1].getComponent('Person').move2Pos(10,10);\r\n\t\twindow.global.persons[2].getComponent('Person').move2Pos(0,10);\r\n\t\twindow.global.persons[3].getComponent('Person').move2Pos(10,0);\r\n\t\tfor (var i=0;i<window.global.persons.length;i++){\r\n\t\t\tvar nowPerson=window.global.persons[i];\r\n\t\t\tvar ctx=cc.find(\"bloodBar/bar\", nowPerson).getComponent(cc.Graphics);\r\n\t\t\tctx.clear();\r\n\t\t\tctx.strokeColor = cc.Color.RED;\r\n\t\t\tctx.moveTo(-40, -150);\r\n\t\t\tctx.lineWidth=10;\r\n\t\t\tctx.lineTo(60, -150);\r\n\t\t\tctx.stroke();   \r\n\t\t\tvar text=cc.find(\"bloodBar/text\", nowPerson);\r\n\t\t\ttext.getComponent(cc.Label).fontSize=25;\r\n\t\t\tconsole.log(text.getComponent(cc.Label));\r\n\t\t\ttext.setPosition(-100,-150);\r\n\t\t\t\r\n\t\t\t//设置行动值\r\n\t\t\tctx=cc.find(\"mobilityBar/bar\", nowPerson).getComponent(cc.Graphics);\r\n\t\t\tctx.clear();\r\n\t\t\tctx.strokeColor = cc.Color.GREEN;\r\n\t\t\tctx.moveTo(-40, -180);\r\n\t\t\tctx.lineTo(60, -180);\r\n\t\t\tctx.lineWidth=10;\r\n\t\t\tctx.stroke();  \r\n\t\t\ttext=cc.find(\"mobilityBar/text\", nowPerson);\r\n\t\t\ttext.getComponent(cc.Label).fontSize=25;\r\n\t\t\tconsole.log(text.getComponent(cc.Label));\r\n\t\t\ttext.setPosition(-100,-200);\t\t\t\r\n\t\t}\r\n\t},\r\n\tinitBgm:function(){\r\n\t\tcc.loader.loadRes('bgm/天空之城钢琴曲', cc.AudioClip, function (err, clip) {\r\n\t\t\tvar audioID = cc.audioEngine.play(clip, true, 0.5);\r\n\t\t});\r\n\t},\r\n\tInitialCard: function() {\r\n\t\tvar cardName = ['炸弹','精准导弹','地雷','庇护','天使的庇护','战神的祝福','虚弱','团队的力量',\r\n\t\t\t\t\t\t\t'治愈','圣光普照','望远镜','眼睛','猛男的祝福','盗取','束缚','迷惑','拯救'];\r\n\t\tvar totCardNum = 17;\r\n\t\twindow.global.cardnode = new Array();\r\n\t\tfor (var i = 0; i < totCardNum; i++) {\r\n\t\t\tvar node = new cc.Node(cardName[i]);\r\n\t\t\tnode.addComponent(cc.Sprite);\r\n\t\t\tnode.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(cc.url.raw('resources/卡牌图片/'+cardName[i]+'.jpg'));\r\n\t\t\twindow.global.cardnode.push(node);\r\n\t\t}\r\n\t\tthis.initBgm();\r\n\t},\r\n});\r\n\r\n\r\n//生成从minNum到maxNum的随机数\r\nfunction randomNum(minNum,maxNum){ \r\n    switch(arguments.length){ \r\n        case 1: \r\n            return parseInt(Math.random()*minNum+1,10); \r\n        break; \r\n        case 2: \r\n            return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10); \r\n        break; \r\n            default: \r\n                return 0; \r\n            break; \r\n    } \r\n} "]}