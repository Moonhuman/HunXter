{"version":3,"sources":["assets\\scripts\\Mist.js"],"names":["cc","Class","Component","properties","basex","basey","stepx","stepy","singleMist","mistArr","cnt","map","onLoad","Node","addComponent","Sprite","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","bind","start","getMistArr","find","map_matrix","Array","i","j","instantiate","setPosition","parent","node","update","dt","person","dis","BfsDis","posX","posY","sight","active","eyes","length","index","Number","name","teammate","enemy1","enemy2","isDead","exposed","ps2","ps4","avatar","opacity"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\t\tbasex: 0,\r\n\t\tbasey: 0,\r\n\t\tstepx: 0,\r\n\t\tstepy: 0,\r\n        singleMist: null,\r\n\t\tmistArr: null,\r\n\t\tcnt:0,\r\n\t\tmap:null,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n\t\tthis.singleMist = new cc.Node();\r\n\t\tthis.singleMist.addComponent(cc.Sprite);\r\n\t\tcc.loader.loadRes('迷雾',cc.SpriteFrame,function(err,spriteFrame) {\r\n            this.getComponent(cc.Sprite).spriteFrame = spriteFrame;\r\n\t    }.bind(this.singleMist));\r\n\t},\r\n\r\n    start () {\r\n\t\t\r\n\t\t\r\n    },\r\n\tgetMistArr: function() {\r\n\t\tthis.map = cc.find('Canvas/map').getComponent('GetMap');\r\n\t\tvar map_matrix = [\r\n\t\t\t[1,1,1,1,1,1,1,1,1,1,1],\r\n\t\t\t[1,1,0,0,0,1,0,0,0,1,1],\r\n\t\t\t[1,0,1,0,0,1,0,0,1,0,1],\r\n\t\t\t[1,0,0,1,1,0,1,1,0,0,1],\r\n\t\t\t[1,0,0,1,0,0,0,1,0,0,1],\r\n\t\t\t[1,1,1,1,1,1,1,1,1,1,1],\r\n\t\t\t[1,0,0,1,0,0,0,1,0,0,1],\r\n\t\t\t[1,0,0,1,1,0,1,1,0,0,1],\r\n\t\t\t[1,0,1,0,0,1,0,0,1,0,1],\r\n\t\t\t[1,1,0,0,0,1,0,0,0,1,1],\r\n\t\t\t[1,1,1,1,1,1,1,1,1,1,1],\r\n\t\t];\r\n\t\tthis.mistArr = new Array();\r\n\t\tfor (var i = 0; i < 11; i++) {\r\n\t\t\tthis.mistArr[i] = new Array();\r\n\t\t\tfor (var j = 0; j < 11; j++) {\r\n\t\t\t\tif (map_matrix[i][j] == 0)\r\n\t\t\t\t\tthis.mistArr[i][j] = null;\r\n\t\t\t\telse {\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.mistArr[i][j] = cc.instantiate(this.singleMist);\r\n\t\t\t\t\tthis.mistArr[i][j].setPosition(this.basex+this.stepx*i, this.basey+this.stepy*j);\r\n\t\t\t\t\tthis.mistArr[i][j].parent = this.node;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n    update (dt) {\r\n\t\tif (this.cnt == 10) {\r\n\t\t\tthis.getMistArr();\r\n\t\t}\r\n\t\tthis.cnt++;\r\n\t\t\r\n\t\t\r\n\t\tif (this.cnt == 16) {\r\n\t\t\tthis.cnt -= 5;\r\n\t\t\tvar person = cc.find('Canvas/Persons/Person1').getComponent('Person');\r\n\t\t\tvar dis = this.map.BfsDis(person.posX, person.posY);\r\n\t\t\tfor (var i = 0; i < 11; i++) {\r\n\t\t\t\tfor (var j = 0; j < 11; j++) {\r\n\t\t\t\t\tif (dis[i][j] == -1)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tif (dis[i][j] <= person.sight)\r\n\t\t\t\t\t\tthis.mistArr[i][j].active = false;\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tthis.mistArr[i][j].active = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var i=0;i<person.eyes.length;++i){\r\n\t\t\t\tfor (var j=0;j<person.eyes[i].length;++j){\r\n\t\t\t\t\tthis.mistArr[person.eyes[i][j][0]][person.eyes[i][j][1]].active=false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar index=Number(person.node.name[6]);\r\n\t\t\tvar teammate=index+2>4?index-2:index+2;\r\n\t\t\tvar enemy1=index+1>4?index-3:index+1;\r\n\t\t\tvar enemy2=teammate+1>4?teammate-3:teammate+1;\r\n\t\t\tteammate=cc.find(\"Canvas/Persons/Person\"+teammate).getComponent('Person');\r\n\t\t\tdis = this.map.BfsDis(teammate.posX, teammate.posY);\r\n\t\t\tfor (var i = 0; i < 11; i++) {\r\n\t\t\t\tfor (var j = 0; j < 11; j++) {\r\n\t\t\t\t\tif (dis[i][j] == -1)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tif (dis[i][j] <= person.sight)\r\n\t\t\t\t\t\tthis.mistArr[i][j].active = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var i=0;i<teammate.eyes.length;++i){\r\n\t\t\t\tfor (var j=0;j<teammate.eyes[i].length;++j)\r\n\t\t\t\t\tthis.mistArr[teammate.eyes[i][j][0]][teammate.eyes[i][j][1]].active=false;\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\tenemy1=cc.find(\"Canvas/Persons/Person\"+enemy1).getComponent('Person');\r\n\t\t\tenemy2=cc.find(\"Canvas/Persons/Person\"+enemy2).getComponent('Person');\r\n\t\t\tif (enemy1.isDead == 0 && enemy1.exposed == 1)\r\n\t\t\t\tthis.mistArr[enemy1.posX][enemy1.posY].active = false;\r\n\t\t\tif (enemy2.isDead == 0 && enemy2.exposed == 1)\r\n\t\t\t\tthis.mistArr[enemy2.posX][enemy2.posY].active = false;\r\n\t\t\t\r\n\t\t\tvar ps2 = cc.find('Canvas/Persons/Person2').getComponent('Person');\r\n\t\t\tvar ps4 = cc.find('Canvas/Persons/Person4').getComponent('Person');\r\n\t\t\tif (this.mistArr[ps2.posX][ps2.posY].active == true && ps2.exposed != 1)\r\n\t\t\t\tps2.avatar.opacity = 0;\r\n\t\t\telse\r\n\t\t\t\tps2.avatar.opacity = 255;\r\n\t\t\tif (this.mistArr[ps4.posX][ps4.posY].active == true && ps4.exposed != 1)\r\n\t\t\t\tps4.avatar.opacity = 0;\r\n\t\t\telse\r\n\t\t\t\tps4.avatar.opacity = 255;\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t},\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"]}