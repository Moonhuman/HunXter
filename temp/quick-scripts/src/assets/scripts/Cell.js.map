{"version":3,"sources":["assets\\scripts\\Cell.js"],"names":["cc","Class","Component","properties","mapx","mapy","kind","inMonitor","routeID","setColor","node","color","resetColor","getOneCard","person_js","cardName","totCardNum","cardID","Math","floor","random","cards","push","instantiate","window","global","cardnode","setPosition","msg","on","event","game","emit","destroy","parent","chooseFromThree","cd","console","log","i","name","find","getComponent","nowPlayer","j","eventAction","rand_event","note","Node","addComponent","Sprite","self","event_name","useCardEnabled","goEnabled","blood","turn","loader","loadRes","SpriteFrame","err","spriteFrame","stepOnCell","person","rand_val","onLoad","start"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAEAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE;AACdC,IAAAA,IAAI,EAAE,CADQ;AACL;AACTC,IAAAA,IAAI,EAAE,CAFQ;AAEN;AACRC,IAAAA,IAAI,EAAE,IAHQ;AAGF;AACZC,IAAAA,SAAS,EAAE,CAJG;AAIA;AACdC,IAAAA,OAAO,EAAE,IALK,CAKC;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AArBQ,GAHP;AA2BRC,EAAAA,QAAQ,EAAE,oBAAW;AACpB;AACA,SAAKC,IAAL,CAAUC,KAAV,GAAkBX,EAAE,CAACW,KAAH,CAAS,GAAT,EAAa,GAAb,EAAiB,GAAjB,EAAqB,GAArB,CAAlB;AACA,GA9BO;AAgCRC,EAAAA,UAAU,EAAE,sBAAW;AACtB;AACA,SAAKF,IAAL,CAAUC,KAAV,GAAkBX,EAAE,CAACW,KAAH,CAAS,GAAT,EAAa,GAAb,EAAiB,GAAjB,EAAqB,GAArB,CAAlB;AACA,GAnCO;AAqCRE,EAAAA,UAAU,EAAE,oBAASC,SAAT,EAAoBC,QAApB,EAA8BC,UAA9B,EAA0C;AACrD;AACA,QAAIC,MAAM,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAcJ,UAAzB,CAAb;AACAF,IAAAA,SAAS,CAACO,KAAV,CAAgBC,IAAhB,CAAqBL,MAArB,EAHqD,CAIrD;;AACA,QAAIP,IAAI,GAAGV,EAAE,CAACuB,WAAH,CAAeC,MAAM,CAACC,MAAP,CAAcC,QAAd,CAAuBT,MAAvB,CAAf,CAAX;AACAP,IAAAA,IAAI,CAACiB,WAAL,CAAiB,CAAjB,EAAoB,CAApB,EANqD,CAOrD;;AACAjB,IAAAA,IAAI,CAACkB,GAAL,GAAW,UAAQb,QAAQ,CAACE,MAAD,CAA3B;AACAP,IAAAA,IAAI,CAACmB,EAAL,CAAQ,WAAR,EAAqB,UAAWC,KAAX,EAAmB;AACvC9B,MAAAA,EAAE,CAAC+B,IAAH,CAAQC,IAAR,CAAa,iBAAb,EAAgC,KAAKJ,GAArC;AACA,WAAKK,OAAL;AACA,KAHD,EAGGvB,IAHH;AAIAA,IAAAA,IAAI,CAACwB,MAAL,GAAc,KAAKxB,IAAL,CAAUwB,MAAV,CAAiBA,MAA/B;AACA,GAnDO;AAqDRC,EAAAA,eAAe,EAAE,yBAASpB,QAAT,EAAmBC,UAAnB,EAA+B;AAC/C,QAAIoB,EAAE,GAAG,EAAT;AACAA,IAAAA,EAAE,CAAC,CAAD,CAAF,GAAQlB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAcJ,UAAzB,CAAR;AACAoB,IAAAA,EAAE,CAAC,CAAD,CAAF,GAAQlB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAcJ,UAAzB,CAAR;AACAoB,IAAAA,EAAE,CAAC,CAAD,CAAF,GAAQlB,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAcJ,UAAzB,CAAR;AAEAqB,IAAAA,OAAO,CAACC,GAAR,CAAYF,EAAZ;;AAEA,SAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC3B,UAAI7B,IAAI,GAAGV,EAAE,CAACuB,WAAH,CAAeC,MAAM,CAACC,MAAP,CAAcC,QAAd,CAAuBU,EAAE,CAACG,CAAD,CAAzB,CAAf,CAAX;AACA7B,MAAAA,IAAI,CAAC8B,IAAL,GAAY,oBAAkBD,CAA9B;AACA7B,MAAAA,IAAI,CAACiB,WAAL,CAAiB,CAAC,GAAD,GAAK,MAAIY,CAA1B,EAA6B,CAA7B;AACA7B,MAAAA,IAAI,CAACO,MAAL,GAAcmB,EAAE,CAACG,CAAD,CAAhB;AACA7B,MAAAA,IAAI,CAACkB,GAAL,GAAW,UAAQb,QAAQ,CAACqB,EAAE,CAACG,CAAD,CAAH,CAA3B;AACA7B,MAAAA,IAAI,CAACmB,EAAL,CAAQ,WAAR,EAAqB,UAASC,KAAT,EAAgB;AACpC,YAAIhB,SAAS,GAAGd,EAAE,CAACyC,IAAH,CAAQ,QAAR,EAAkBC,YAAlB,CAA+B,YAA/B,EAA6CC,SAA7C,CAAuDD,YAAvD,CAAoE,QAApE,CAAhB;AACAL,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAQ,KAAKrB,MAAzB;AACAH,QAAAA,SAAS,CAACO,KAAV,CAAgBC,IAAhB,CAAqB,KAAKL,MAA1B;AACAjB,QAAAA,EAAE,CAAC+B,IAAH,CAAQC,IAAR,CAAa,iBAAb,EAAgC,KAAKJ,GAArC;;AACA,aAAK,IAAIgB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC3B5C,UAAAA,EAAE,CAACyC,IAAH,CAAQ,2BAAyBG,CAAjC,EAAoCX,OAApC;AACA;AACD,OARD,EAQGvB,IARH;AASAA,MAAAA,IAAI,CAACwB,MAAL,GAAc,KAAKxB,IAAL,CAAUwB,MAAV,CAAiBA,MAA/B;AACA;AAED,GA/EO;AAiFRW,EAAAA,WAAW,EAAE,qBAAS/B,SAAT,EAAoB;AAChC;AACA,QAAIgC,UAAU,GAAG5B,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAc,CAAzB,CAAjB,CAFgC,CAGhC;;AACA,QAAI2B,IAAI,GAAG,IAAI/C,EAAE,CAACgD,IAAP,EAAX;AACAD,IAAAA,IAAI,CAACE,YAAL,CAAkBjD,EAAE,CAACkD,MAArB;AACAH,IAAAA,IAAI,CAACpB,WAAL,CAAiB,CAAjB,EAAoB,CAApB;AACAoB,IAAAA,IAAI,CAACb,MAAL,GAAc,KAAKxB,IAAL,CAAUwB,MAAV,CAAiBA,MAA/B;AACA,QAAIiB,IAAI,GAAGJ,IAAX;AAAA,QAAiBK,UAAjB;;AACA,QAAIN,UAAU,IAAI,CAAlB,EAAqB;AAAE;AACtBM,MAAAA,UAAU,GAAG,IAAb;AACAtC,MAAAA,SAAS,CAACuC,cAAV,GAA2B,CAA3B,CAFoB,CAEU;AAC9B;AACA,KAJD,MAKK,IAAIP,UAAU,IAAI,CAAlB,EAAqB;AAAE;AAC3BM,MAAAA,UAAU,GAAG,IAAb,CADyB,CACN;;AACnBtC,MAAAA,SAAS,CAACwC,SAAV,GAAsB,CAAtB,CAFyB,CAGzB;AACA,KAJI,MAKA,IAAIR,UAAU,IAAI,CAAlB,EAAqB;AAAE;AAC3BM,MAAAA,UAAU,GAAG,IAAb,CADyB,CACL;;AACpBtC,MAAAA,SAAS,CAACyC,KAAV;AACA,KAHI,MAIA,IAAIT,UAAU,IAAI,CAAlB,EAAqB;AAAE;AAC3BM,MAAAA,UAAU,GAAG,KAAb;AACAtC,MAAAA,SAAS,CAAC0C,IAAV,GAFyB,CAEP;AAClB,KAHI,MAIA,IAAIV,UAAU,IAAI,CAAlB,EAAqB;AAAE;AAC3BM,MAAAA,UAAU,GAAG,IAAb,CADyB,CACL;AACpB,KAFI,MAGA,IAAIN,UAAU,IAAI,CAAlB,EAAqB;AAAE;AAC3BM,MAAAA,UAAU,GAAG,IAAb;AACAtC,MAAAA,SAAS,CAACyC,KAAV,GAAkBrC,IAAI,CAACC,KAAL,CAAWL,SAAS,CAACyC,KAAV,GAAgB,GAA3B,CAAlB;AACA;;AACDvD,IAAAA,EAAE,CAACyD,MAAH,CAAUC,OAAV,CAAkB,UAAQN,UAA1B,EAAsCpD,EAAE,CAAC2D,WAAzC,EAAsD,UAAUC,GAAV,EAAeC,WAAf,EAA4B;AACjFV,MAAAA,IAAI,CAACT,YAAL,CAAkB1C,EAAE,CAACkD,MAArB,EAA6BW,WAA7B,GAA2CA,WAA3C;AACA,KAFD,EAlCgC,CAqChC;;AACAd,IAAAA,IAAI,CAACnB,GAAL,GAAW,UAAQwB,UAAnB;AACAL,IAAAA,IAAI,CAAClB,EAAL,CAAQ,WAAR,EAAqB,UAAWC,KAAX,EAAmB;AACvC9B,MAAAA,EAAE,CAAC+B,IAAH,CAAQC,IAAR,CAAa,iBAAb,EAAgC,KAAKJ,GAArC;AACA,WAAKK,OAAL;AAEA,KAJD,EAIGc,IAJH;AAKA,GA7HO;AA+HRe,EAAAA,UAAU,EAAE,oBAASC,MAAT,EAAiB;AAE5B;AACA,QAAIjD,SAAS,GAAGiD,MAAM,CAACrB,YAAP,CAAoB,QAApB,CAAhB;;AAEA,QAAI,KAAKpC,IAAL,IAAa,CAAjB,EAAoB;AAAC;AACpBN,MAAAA,EAAE,CAAC+B,IAAH,CAAQC,IAAR,CAAa,iBAAb,EAAgC,EAAhC,EADmB,CACkB;;AACrC;AACA,KAHD,MAIK,IAAI,KAAK1B,IAAL,IAAa,CAAjB,EAAoB;AAAC;AACzB,UAAIS,QAAQ,GAAG,CAAC,IAAD,EAAM,MAAN,EAAa,IAAb,EAAkB,IAAlB,EAAuB,OAAvB,EAA+B,OAA/B,EAAuC,IAAvC,EAA4C,OAA5C,EACX,IADW,EACN,MADM,EACC,KADD,EACO,IADP,EACY,OADZ,EACoB,IADpB,EACyB,IADzB,EAC8B,IAD9B,EACmC,IADnC,CAAf;AAEA,UAAIC,UAAU,GAAG,EAAjB;AACA,UAAIgD,QAAQ,GAAG9C,IAAI,CAACE,MAAL,EAAf;AACAiB,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAW0B,QAAvB;;AACA,UAAIA,QAAQ,GAAG,GAAf,EAAoB;AAAE;AACrB,aAAKnD,UAAL,CAAgBC,SAAhB,EAA2BC,QAA3B,EAAqCC,UAArC;AACA,OAFD,MAGI;AAAE;AACL,aAAKmB,eAAL,CAAqBpB,QAArB,EAA+BC,UAA/B;AACA;AACD,KAZI,MAaA,IAAI,KAAKV,IAAL,IAAa,CAAjB,EAAoB;AAAE;AAC1B,WAAKuC,WAAL,CAAiB/B,SAAjB,EADwB,CACK;AAC7B;AACD,GAxJO;AA0JL;AAEAmD,EAAAA,MA5JK,oBA4JK,CAEZ,CA9JO;AAgKLC,EAAAA,KAhKK,mBAgKI;AACX;AAEA,QAAIf,IAAI,GAAG,IAAX;;AACA,QAAI,KAAK7C,IAAL,IAAa,CAAjB,EAAoB;AAAE;AACrBN,MAAAA,EAAE,CAACyD,MAAH,CAAUC,OAAV,CAAkB,MAAlB,EAA0B1D,EAAE,CAAC2D,WAA7B,EAA0C,UAAUC,GAAV,EAAeC,WAAf,EAA4B;AACrEV,QAAAA,IAAI,CAACzC,IAAL,CAAUgC,YAAV,CAAuB1C,EAAE,CAACkD,MAA1B,EAAkCW,WAAlC,GAAgDA,WAAhD;AACA,OAFD;AAGA,KAJD,MAKK,IAAI,KAAKvD,IAAL,IAAa,CAAjB,EAAoB;AAAE;AAC1BN,MAAAA,EAAE,CAACyD,MAAH,CAAUC,OAAV,CAAkB,KAAlB,EAAyB1D,EAAE,CAAC2D,WAA5B,EAAyC,UAAUC,GAAV,EAAeC,WAAf,EAA4B;AACpEV,QAAAA,IAAI,CAACzC,IAAL,CAAUgC,YAAV,CAAuB1C,EAAE,CAACkD,MAA1B,EAAkCW,WAAlC,GAAgDA,WAAhD;AACA,OAFD;AAGA,KAJI,MAKA;AAAE;AACN7D,MAAAA,EAAE,CAACyD,MAAH,CAAUC,OAAV,CAAkB,KAAlB,EAAyB1D,EAAE,CAAC2D,WAA5B,EAAyC,UAAUC,GAAV,EAAeC,WAAf,EAA4B;AACpEV,QAAAA,IAAI,CAACzC,IAAL,CAAUgC,YAAV,CAAuB1C,EAAE,CAACkD,MAA1B,EAAkCW,WAAlC,GAAgDA,WAAhD;AACA,OAFD;AAGA;AACE,GAnLI,CAqLL;;AArLK,CAAT","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\t\tmapx: 0, //在map[i][j]中的横坐标\n\t\tmapy: 0,//在map[i][j]中的纵坐标\n\t\tkind: null, //格子的类型，0:空白格，1:卡牌格，2:事件格\n\t\tinMonitor: 0, //用来判断是否处于监听中的标记\n\t\trouteID: null, //记录这个cell是map中哪条route的终点，即在routes中的下标\n\t\t\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n    },\n\t\n\tsetColor: function() {\n\t\t//设置cell的颜色为红色，表示可走\n\t\tthis.node.color = cc.color(102,255,102,255);\n\t},\n\t\n\tresetColor: function() {\n\t\t//还原cell的颜色\n\t\tthis.node.color = cc.color(255,255,255,255);\n\t},\n\t\n\tgetOneCard: function(person_js, cardName, totCardNum) {\n\t\t//随机获得1张牌\n\t\tvar cardID = Math.floor(Math.random()*totCardNum);\n\t\tperson_js.cards.push(cardID);\n\t\t//创建用来提示获得卡牌的精灵节点\n\t\tvar node = cc.instantiate(window.global.cardnode[cardID]);\n\t\tnode.setPosition(0, 0);\n\t\t//开启note节点的监听，点击后消失\n\t\tnode.msg = '获得卡牌:'+cardName[cardID];\n\t\tnode.on('mousedown', function ( event ) {\n\t\t\tcc.game.emit('stepOnCell-done', this.msg);\n\t\t\tthis.destroy();\n\t\t}, node);\n\t\tnode.parent = this.node.parent.parent;\n\t},\n\t\n\tchooseFromThree: function(cardName, totCardNum) {\n\t\tvar cd = [];\n\t\tcd[0] = Math.floor(Math.random()*totCardNum);\n\t\tcd[1] = Math.floor(Math.random()*totCardNum);\n\t\tcd[2] = Math.floor(Math.random()*totCardNum);\n\t\t\n\t\tconsole.log(cd);\n\n\t\tfor (var i = 0; i < 3; i++) {\n\t\t\tvar node = cc.instantiate(window.global.cardnode[cd[i]]);\n\t\t\tnode.name = 'chooseFromThree'+i;\n\t\t\tnode.setPosition(-500+500*i, 0);\n\t\t\tnode.cardID = cd[i];\n\t\t\tnode.msg = '获得卡牌:'+cardName[cd[i]];\n\t\t\tnode.on('mousedown', function(event) {\n\t\t\t\tvar person_js = cc.find('Canvas').getComponent('globalGame').nowPlayer.getComponent('Person');\n\t\t\t\tconsole.log('得到卡牌:'+this.cardID);\n\t\t\t\tperson_js.cards.push(this.cardID);\n\t\t\t\tcc.game.emit('stepOnCell-done', this.msg);\n\t\t\t\tfor (var j = 0; j < 3; j++) {\n\t\t\t\t\tcc.find('Canvas/chooseFromThree'+j).destroy();\n\t\t\t\t}\n\t\t\t}, node)\n\t\t\tnode.parent = this.node.parent.parent;\n\t\t}\n\t\t\n\t},\n\t\n\teventAction: function(person_js) {\n\t\t//随机产生6个事件之一\n\t\tvar rand_event = Math.floor(Math.random()*6);\n\t\t//创建用来提示获得触发事件的精灵节点\n\t\tvar note = new cc.Node();\n\t\tnote.addComponent(cc.Sprite);\n\t\tnote.setPosition(0, 0);\n\t\tnote.parent = this.node.parent.parent;\n\t\tvar self = note, event_name;\n\t\tif (rand_event == 0) { //陷阱\n\t\t\tevent_name = \"陷阱\";\n\t\t\tperson_js.useCardEnabled = 0; //本回合不可使用卡牌,下回合置1\n\t\t\t//warning: 下回合记得改变\n\t\t}\n\t\telse if (rand_event == 1) { //监狱\n\t\t\tevent_name = \"监狱\"; //下回合不可走\n\t\t\tperson_js.goEnabled = 0;\n\t\t\t//warning: 下回合记得改变\n\t\t}\n\t\telse if (rand_event == 2) { //恶魔\n\t\t\tevent_name = \"恶魔\";  //损失一滴血量\n\t\t\tperson_js.blood--;\n\t\t}\n\t\telse if (rand_event == 3) { //奥利给\n\t\t\tevent_name = \"奥利给\";\n\t\t\tperson_js.turn++; //获得回合\n\t\t}\n\t\telse if (rand_event == 4) { //视野\n\t\t\tevent_name = \"视野\";  //to do\n\t\t}\n\t\telse if (rand_event == 5) { //天使\n\t\t\tevent_name = \"天使\";\n\t\t\tperson_js.blood = Math.floor(person_js.blood*1.5);\n\t\t}\n\t\tcc.loader.loadRes('事件图片/'+event_name, cc.SpriteFrame, function (err, spriteFrame) {\n\t\t\tself.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t});\n\t\t//开启note节点的监听，点击后消失\n\t\tnote.msg = '触发事件:'+event_name;\n\t\tnote.on('mousedown', function ( event ) {\n\t\t\tcc.game.emit('stepOnCell-done', this.msg);\n\t\t\tthis.destroy();\n\t\t\t\n\t\t}, note);\n\t},\n\t\n\tstepOnCell: function(person) {\n\t\t\n\t\t//获取person节点的组件\n\t\tvar person_js = person.getComponent('Person');\n\t\t\n\t\tif (this.kind == 0) {//空白格\n\t\t\tcc.game.emit('stepOnCell-done', ''); //发送空串\n\t\t\treturn;\n\t\t}\n\t\telse if (this.kind == 1) {//卡牌格\n\t\t\tvar cardName = ['炸弹','精准导弹','地雷','庇护','天使的庇护','战神的祝福','虚弱','团队的力量',\n\t\t\t\t\t\t\t'治愈','圣光普照','望远镜','眼睛','猛男的祝福','盗取','束缚','迷惑','拯救'];\n\t\t\tvar totCardNum = 17\n\t\t\tvar rand_val = Math.random();\n\t\t\tconsole.log('rand_val'+rand_val);\n\t\t\tif (rand_val < 0.5) { //得到一张牌\n\t\t\t\tthis.getOneCard(person_js, cardName, totCardNum);\n\t\t\t}\n\t\t\telse{ //三张中抽一张\n\t\t\t\tthis.chooseFromThree(cardName, totCardNum);\n\t\t\t}\n\t\t}\n\t\telse if (this.kind == 2) { //事件格\n\t\t\tthis.eventAction(person_js); //响应事件\n\t\t}\n\t},\n\t\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n\t\t\n\t},\n\n    start () {\n\t\t//设置格子图片\n\t\t\n\t\tvar self = this;\n\t\tif (this.kind == 0) { //空白格\n\t\t\tcc.loader.loadRes(\"cell\", cc.SpriteFrame, function (err, spriteFrame) {\n\t\t\t\tself.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t\t});\n\t\t}\n\t\telse if (this.kind == 1) { //卡牌格\n\t\t\tcc.loader.loadRes(\"抽卡格\", cc.SpriteFrame, function (err, spriteFrame) {\n\t\t\t\tself.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t\t});\n\t\t}\n\t\telse { //事件格\n\t\t\tcc.loader.loadRes(\"事件格\", cc.SpriteFrame, function (err, spriteFrame) {\n\t\t\t\tself.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t\t});\n\t\t}\n    },\n\n    // update (dt) {},\n});\n\n\n\n\n\n\n\n\n\n\n\n\n"]}