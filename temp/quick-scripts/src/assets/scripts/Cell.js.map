{"version":3,"sources":["assets\\scripts\\Cell.js"],"names":["cc","Class","Component","properties","mapx","mapy","kind","inMonitor","routeID","setColor","node","color","resetColor","chooseFromThree","cardName","totCardNum","cd","Math","floor","random","console","log","i","instantiate","window","global","cardnode","name","setPosition","cardID","on","event","person_js","find","getComponent","nowPlayer","cards","push","game","emit","j","destroy","parent","stepOnCell","person","rand_val","rand_event","note","Node","addComponent","Sprite","self","event_name","useCardEnabled","goEnabled","blood","turn","loader","loadRes","SpriteFrame","err","spriteFrame","onLoad","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - https://docs.cocos.com/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\t\tmapx: 0, //在map[i][j]中的横坐标\n\t\tmapy: 0,//在map[i][j]中的纵坐标\n\t\tkind: null, //格子的类型，0:空白格，1:卡牌格，2:事件格\n\t\tinMonitor: 0, //用来判断是否处于监听中的标记\n\t\trouteID: null, //记录这个cell是map中哪条route的终点，即在routes中的下标\n\t\t\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n    },\n\t\n\tsetColor: function() {\n\t\t//设置cell的颜色为红色，表示可走\n\t\tthis.node.color = cc.color(102,255,102,255);\n\t},\n\t\n\tresetColor: function() {\n\t\t//还原cell的颜色\n\t\tthis.node.color = cc.color(255,255,255,255);\n\t},\n\t\n\tchooseFromThree: function(cardName, totCardNum) {\n\t\tvar cd = [];\n\t\tcd[0] = Math.floor(Math.random()*totCardNum);\n\t\tcd[1] = Math.floor(Math.random()*totCardNum);\n\t\tcd[2] = Math.floor(Math.random()*totCardNum);\n\t\t\n\t\tconsole.log(cd);\n\n\t\tfor (var i = 0; i < 3; i++) {\n\t\t\tvar node = cc.instantiate(window.global.cardnode[cd[i]]);\n\t\t\tnode.name = 'chooseFromThree'+i;\n\t\t\tnode.setPosition(-500+500*i, 0);\n\t\t\tnode.cardID = cd[i];\n\t\t\tnode.on('mousedown', function(event) {\n\t\t\t\tvar person_js = cc.find('Canvas').getComponent('globalGame').nowPlayer.getComponent('Person');\n\t\t\t\tconsole.log('得到卡牌:'+this.cardID);\n\t\t\t\tperson_js.cards.push(this.cardID);\n\t\t\t\tcc.game.emit('stepOnCell-done');\n\t\t\t\tfor (var j = 0; j < 3; j++) {\n\t\t\t\t\tcc.find('Canvas/chooseFromThree'+j).destroy();\n\t\t\t\t}\n\t\t\t}, node)\n\t\t\tnode.parent = this.node.parent.parent;\n\t\t}\n\t\t\n\t},\n\t\n\tstepOnCell: function(person) {\n\t\t\n\t\t//获取person节点的组件\n\t\tvar person_js = person.getComponent('Person');\n\t\t\n\t\tif (this.kind == 0) {//空白格\n\t\t\tcc.game.emit('stepOnCell-done');\n\t\t\treturn;\n\t\t}\n\t\telse if (this.kind == 1) {//卡牌格\n\t\t\tvar cardName = ['炸弹','精准导弹','地雷','庇护','天使的庇护','战神的祝福','虚弱','团队的力量',\n\t\t\t\t\t\t\t'治愈','圣光普照','望远镜','眼睛','猛男的祝福','盗取','束缚','迷惑','拯救'];\n\t\t\tvar totCardNum = 17\n\t\t\tvar rand_val = Math.random();\n\t\t\tconsole.log('rand_val'+rand_val);\n\t\t\tif (rand_val < 0.5) {\n\t\t\t\t//随机获得1张牌\n\t\t\t\tvar cardID = Math.floor(Math.random()*totCardNum);\n\t\t\t\tperson_js.cards.push(cardID);\n\t\t\t\t\n\t\t\t\t//创建用来提示获得卡牌的精灵节点\n\t\t\t\tvar node = cc.instantiate(window.global.cardnode[cardID]);\n\t\t\t\tnode.setPosition(0, 0);\n\t\t\t\t//开启note节点的监听，点击后消失\n\t\t\t\tnode.on('mousedown', function ( event ) {\n\t\t\t\t\tcc.game.emit('stepOnCell-done');\n\t\t\t\t\tthis.destroy();\n\t\t\t\t}, node);\n\t\t\t\tnode.parent = this.node.parent.parent;\n\t\t\t}\n\t\t\telse{\n\t\t\t\t//三张中抽一张\n\t\t\t\tthis.chooseFromThree(cardName, totCardNum);\n\t\t\t}\n\t\t}\n\t\telse if (this.kind == 2) { //事件格\n\t\t\t\n\t\t\t//随机产生6个事件之一\n\t\t\tvar rand_event = Math.floor(Math.random()*6);\n\t\t\t//创建用来提示获得触发事件的精灵节点\n\t\t\tvar note = new cc.Node();\n            note.addComponent(cc.Sprite);\n\t\t\tnote.setPosition(0, 0);\n\t\t\tnote.parent = this.node.parent.parent;\n\t\t\tvar self = note, event_name;\n\t\t\tif (rand_event == 0) { //陷阱\n\t\t\t\tevent_name = \"陷阱\";\n\t\t\t\tperson_js.useCardEnabled = 0; //本回合不可使用卡牌,下回合置1\n\t\t\t\t//to do\n\t\t\t\t//warning: 下回合记得改变\n\t\t\t\t//warning: 下回合记得改变\n\t\t\t\t//warning: 下回合记得改变\n\t\t\t}\t\n\t\t\telse if (rand_event == 1) { //监狱\n\t\t\t\tevent_name = \"监狱\"; //下回合不可走\n\t\t\t\tperson_js.goEnabled = 0;\n\t\t\t\t//to do\n\t\t\t\t//warning: 下回合记得改变\n\t\t\t\t//warning: 下回合记得改变\n\t\t\t\t//warning: 下回合记得改变\n\t\t\t}\t\n\t\t\telse if (rand_event == 2) { //恶魔\n\t\t\t\tevent_name = \"恶魔\";  //损失一滴血量\n\t\t\t\tperson_js.blood--;\n\t\t\t}\t\n\t\t\telse if (rand_event == 3) { //奥利给\n\t\t\t\tevent_name = \"奥利给\";\n\t\t\t\tperson_js.turn++; //获得回合\n\t\t\t}\t\n\t\t\telse if (rand_event == 4) { //视野\n\t\t\t\tevent_name = \"视野\";  //to do\n\t\t\t}\t\n\t\t\telse if (rand_event == 5) { //天使\n\t\t\t\tevent_name = \"天使\";\n\t\t\t\tperson_js.blood = Math.floor(person_js.blood*1.5);\n\t\t\t}\t\n\t\t\tcc.loader.loadRes('事件图片/'+event_name, cc.SpriteFrame, function (err, spriteFrame) {\n\t\t\t\tself.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t\t});\n\t\t\t//开启note节点的监听，点击后消失\n\t\t\tnote.on('mousedown', function ( event ) {\n\t\t\t\tcc.game.emit('stepOnCell-done');\n\t\t\t\tthis.destroy();\n\t\t\t\t\n\t\t\t}, note);\n\t\t\t\n\t\t}\n\t},\n\t\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n\t\t\n\t},\n\n    start () {\n\t\t//设置格子图片\n\t\t\n\t\tvar self = this;\n\t\tif (this.kind == 0) { //空白格\n\t\t\tcc.loader.loadRes(\"cell\", cc.SpriteFrame, function (err, spriteFrame) {\n\t\t\t\tself.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t\t});\n\t\t}\n\t\telse if (this.kind == 1) { //卡牌格\n\t\t\tcc.loader.loadRes(\"抽卡格\", cc.SpriteFrame, function (err, spriteFrame) {\n\t\t\t\tself.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t\t});\n\t\t}\n\t\telse { //事件格\n\t\t\tcc.loader.loadRes(\"事件格\", cc.SpriteFrame, function (err, spriteFrame) {\n\t\t\t\tself.node.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n\t\t\t});\n\t\t}\n    },\n\n    // update (dt) {},\n});\n\n\n\n\n\n\n\n\n\n\n\n\n"]}